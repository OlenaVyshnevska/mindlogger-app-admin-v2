webpackJsonp([1],{"1/oy":function(t,e){},"3CQJ":function(t,e){},"45c4":function(t,e,a){t.exports=a.p+"static/img/undraw_experts3_3njd.8f05786.svg"},"4r4C":function(t,e,a){t.exports=a.p+"static/img/undraw_data_trends_b0wg.57a833b.svg"},"53vV":function(t,e){},"7w68":function(t,e){},"9M+g":function(t,e){},Ct4C:function(t,e){},FdbF:function(t,e){},GfHa:function(t,e){},Hp3F:function(t,e){},Id91:function(t,e){},IuGN:function(t,e){},Jmt5:function(t,e){},Jtxc:function(t,e){},KXEG:function(t,e){},KpX4:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("7+uW"),i=a("mvHQ"),n=a.n(i),r=a("e6fC"),o=a("M4fF"),c=a.n(o),l=(a("Jmt5"),a("9M+g"),a("jKqc"),a("UKw4"));s.a.use(r.a);var u={name:"App",data:function(){return{user:{},authToken:{}}},computed:{isLoggedIn:function(){return!c.a.isEmpty(this.user)}},mounted:function(){try{this.user=JSON.parse(l.getItem("user"))||{},this.authToken=JSON.parse(l.getItem("authToken"))||{}}catch(t){this.user={},this.authToken={}}},methods:{saveToken:function(t){this.user=t.user,this.authToken=t.authToken,l.setItem("user",n()(t.user)),l.setItem("authToken",n()(t.authToken))},logout:function(){this.user={},this.authToken={},l.setItem("user",{}),l.setItem("authToken",{})}}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("b-navbar",{attrs:{toggleable:"md",type:"light",variant:"light"}},[a("b-navbar-toggle",{attrs:{target:"nav_collapse"}}),t._v(" "),a("b-navbar-brand",{attrs:{to:"/"}},[t._v("Mindlogger")]),t._v(" "),a("b-collapse",{attrs:{"is-nav":"",id:"nav_collapse"}},[a("b-navbar-nav",[t.isLoggedIn?a("b-nav-item",{attrs:{to:"/activitySets",exact:""}},[t._v("Your Activity Sets")]):t._e()],1),t._v(" "),a("b-navbar-nav",{staticClass:"ml-auto"},[t.isLoggedIn?a("b-nav-item-dropdown",{attrs:{right:""}},[a("template",{slot:"button-content"},[a("em",[t._v(t._s(t.user.login))])]),t._v(" "),a("b-dropdown-item",{attrs:{href:"#"}},[t._v("Profile")]),t._v(" "),a("b-dropdown-item",{on:{click:t.logout}},[t._v("Signout")])],2):a("b-nav-item",{attrs:{to:"/login"}},[t._v("Login")])],1)],1)],1),t._v(" "),a("div",{},[a("router-view",{attrs:{isLoggedIn:t.isLoggedIn,user:t.user,authToken:t.authToken},on:{login:t.saveToken}})],1)],1)},staticRenderFns:[]};var h=a("VU/8")(u,d,!1,function(t){a("IuGN")},null,null).exports,v=a("/ocq"),m={name:"HelloWorld",props:{isLoggedIn:{type:Boolean},user:{type:Object}},data:function(){return{msg:"Welcome to Your Vue.js App"}},mounted:function(){}},p={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home mt-3"},[s("b-container",[s("div",{staticClass:"row"},[s("div",{staticClass:"col-12 text-center"},[s("h1",[t._v("Mindlogger Admin Dashboard v2")]),t._v(" "),s("p",{staticClass:"lead"},[t._v("A dashboard to build mindlogger applications and visualize data")])])]),t._v(" "),s("b-row",{staticClass:"mt-3 pt-3"},[s("b-col",{staticClass:"text-center"},[s("img",{staticClass:"mx-auto w-100",attrs:{src:a("f47A")}})]),t._v(" "),s("b-col",{staticClass:"text-center"},[s("img",{staticClass:"mx-auto w-100",attrs:{src:a("4r4C")}})]),t._v(" "),s("b-col",{staticClass:"text-center"},[s("img",{staticClass:"mx-auto w-100",attrs:{src:a("45c4")}})])],1),t._v(" "),s("b-row",{staticClass:"mt-2 mb-3 pb-3"},[s("b-col",{staticClass:"text-center"},[s("p",[t._v("\n          Build Mindlogger EMAs\n        ")])]),t._v(" "),s("b-col",{staticClass:"text-center"},[s("p",[t._v("\n          Visualize, interact with, and download data\n        ")])]),t._v(" "),s("b-col",{staticClass:"text-center"},[s("p",[t._v("\n          Manage study roles\n        ")])])],1),t._v(" "),s("div",{staticClass:"row mt-3"},[t.isLoggedIn?s("div",{staticClass:"col-12 text-center"},[s("h3",[t._v("Welcome, "+t._s(t.user.firstName)+" !")]),t._v(" "),s("b-button",{attrs:{variant:"primary",to:"/activitySets"}},[t._v("Manage Activity Sets")])],1):s("div",{staticClass:"col-12 text-center"},[s("b-button",{attrs:{variant:"primary",to:"/login"}},[t._v("Log In")]),t._v(" "),s("b-button",{attrs:{variant:"success",to:"/signup"}},[t._v("Sign Up")])],1)])],1)],1)},staticRenderFns:[]};var f=a("VU/8")(m,p,!1,function(t){a("Vdvp")},"data-v-6e3aeddb",null).exports,g=(a("+6Bu"),a("Dd8w")),y=a.n(g),b=a("fZjL"),_=a.n(b),x=a("mtWM"),w=a.n(x),S="https://api.mindlogger.info/api/v1";window.axios=w.a;var k=function(t,e){return w()({method:"GET",url:S+"/folder?parentId="+t+"&parentType=collection",headers:{"Girder-Token":""+e}})},D=function(t){return S+"/"+t+"/download?contentDisposition=inline"},C=function(t,e){return w()({method:"GET",url:S+"/folder/"+t,headers:{"Girder-Token":""+e}})},T=function(t,e){return w()({method:"GET",url:S+"/folder?parentId="+t+"&parentType=folder",headers:{"Girder-Token":""+e}})},I=function(t,e){return w()({method:"GET",url:S+"/folder?parentId="+t+"&parentType=folder",headers:{"Girder-Token":""+e}}).then(function(t){var e=c.a.filter(t.data,function(t){return"Activities"===t.name});if(console.log("activities?",e),e.length)return c.a.filter(t.data,function(t){return"Activities"===t.name})[0]._id}).then(function(t){return t?function(t,e){return w()({method:"GET",url:S+"/folder?parentId="+t+"&parentType=folder",headers:{"Girder-Token":""+e}})}(t,e):{data:[]}})},j=function(t){var e=t.name,a=t.metadata,s=t.parentId,i=t.token,r=new FormData;return r.set("name",e),r.set("metadata",n()(a)),w()({method:"PUT",url:S+"/folder/"+s,headers:{"Girder-Token":""+i},data:r})},A=function(t){return w()({method:"GET",url:S+"/user/"+t})},R={name:"login",data:function(){return{form:{username:null,password:null},errors:{message:null,show:!1,code:null}}},methods:{onSubmit:function(t){var e,a,s,i=this;t.preventDefault(),(e={user:this.form.username,password:this.form.password},a=e.user,s=e.password,w()({method:"get",url:S+"/user/authentication",headers:{"Girder-Authorization":"Basic "+btoa(a+":"+s)}}).then(function(t){return w.a.defaults.headers.common["Girder-Token"]=t.data.authToken.token,t})).then(function(t){i.$emit("login",t.data),i.$router.push("/activitySets")}).catch(function(t){i.errors.code=t.response,401===i.errors.code.status?i.errors.message="We have no record of your username. Please create a new account!":i.errors.message=t.message,i.errors.show=!0})}}},N={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"text-center",attrs:{id:"login"}},[a("h1",[t._v(" Log In ")]),t._v(" "),a("div",{staticClass:"container fluid",attrs:{id:"signupForm"}},[a("b-alert",{attrs:{show:t.errors.show,variant:"danger"}},[t._v(t._s(t.errors.message))]),t._v(" "),a("b-form",{on:{submit:t.onSubmit}},[a("b-form-group",{attrs:{id:"usernameInputGroup",label:"Username:","label-for":"username"}},[a("b-form-input",{attrs:{id:"username",required:"",placeholder:"Enter email"},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}})],1),t._v(" "),a("b-form-group",{attrs:{id:"passwordInputGroup",label:"Password:","label-for":"passwordInput"}},[a("b-form-input",{attrs:{id:"passwordInput",type:"password",required:"",placeholder:"Password"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),t._v(" "),a("b-button",{attrs:{type:"submit",variant:"primary"}},[t._v("Submit")])],1),t._v(" "),a("p",{staticClass:"mt-3"},[t._v("\n      Don't have an account? "),a("router-link",{attrs:{to:"/signup"}},[t._v("Create one")])],1),t._v(" "),a("p",{staticClass:"mt-3"},[t._v("\n      Forgot your password? "),a("router-link",{attrs:{to:"/forgot"}},[t._v("Reset it")])],1)],1)])},staticRenderFns:[]};var M=a("VU/8")(R,N,!1,function(t){a("53vV")},null,null).exports,L={name:"signup",data:function(){return{form:{email:"",password:"",password2:"",login:"",firstName:"",lastName:""},show:!0,errors:{show:!1,message:null,code:null}}},computed:{validated:function(){return this.form.password===this.form.password2}},methods:{onSubmit:function(t){var e,a=this;t.preventDefault(),(e={email:this.form.email,password:this.form.password,login:this.form.login,firstName:this.form.firstName,lastName:this.form.lastName},w()({method:"post",url:S+"/user",params:y()({},e,{admin:!0})})).then(function(t){var e=c.a.filter(_()(t.data),function(t){return"authToken"!==t}),s={};c.a.map(e,function(e){s[e]=t.data[e]}),a.$emit("login",{authToken:t.data.authToken,user:s}),a.$router.push("/activitySets")}).catch(function(t){a.errors.show=!0,a.errors.code=t.response,a.errors.message=t.response.data.message})}}},U={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pt-3",attrs:{id:"signup"}},[a("h1",{staticClass:"text-center"},[t._v(" Sign Up ")]),t._v(" "),a("div",{staticClass:"container fluid",attrs:{id:"signupForm"}},[a("b-form",{attrs:{validated:""},on:{submit:t.onSubmit}},[a("b-alert",{attrs:{show:t.errors.show,variant:"danger"}},[t._v(t._s(t.errors.message))]),t._v(" "),a("b-form-group",{attrs:{id:"emailAddressInputGroup",label:"Email address:","label-for":"emailAddress",description:"We'll never share your email with anyone else."}},[a("b-form-input",{attrs:{id:"emailAddress",type:"email",required:"",placeholder:"Enter email"},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),t._v(" "),a("b-form-group",{attrs:{id:"usernameInputGroup",label:"Username:","label-for":"usernameInput",description:""}},[a("b-form-input",{attrs:{id:"usernameInput",type:"text",required:"",placeholder:"Choose a username"},model:{value:t.form.login,callback:function(e){t.$set(t.form,"login",e)},expression:"form.login"}})],1),t._v(" "),a("b-form-group",{attrs:{id:"firstNameInputGroup",label:"First Name:","label-for":"firstNameInput",description:""}},[a("b-form-input",{attrs:{id:"firstNameInput",type:"text",required:"",placeholder:"First Name"},model:{value:t.form.firstName,callback:function(e){t.$set(t.form,"firstName",e)},expression:"form.firstName"}})],1),t._v(" "),a("b-form-group",{attrs:{id:"lastNameInputGroup",label:"Last Name:","label-for":"lastNameInput",description:""}},[a("b-form-input",{attrs:{id:"lastNameInput",type:"text",required:"",placeholder:"Last Name"},model:{value:t.form.lastName,callback:function(e){t.$set(t.form,"lastName",e)},expression:"form.lastName"}})],1),t._v(" "),a("b-form-group",{attrs:{id:"passwordInputGroup",label:"Password:","label-for":"passwordInput"}},[a("b-form-input",{attrs:{id:"passwordInput",type:"password",required:"",placeholder:"Password"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),t._v(" "),a("b-form-group",{attrs:{id:"password2InputGroup",label:"Confirm Password:","label-for":"password2Input"}},[a("b-alert",{attrs:{show:!t.validated,variant:"danger"}},[t._v("\n          Make sure your passwords match!\n        ")]),t._v(" "),a("b-form-input",{attrs:{id:"password2Input",type:"password",required:"",placeholder:"Confirm password"},model:{value:t.form.password2,callback:function(e){t.$set(t.form,"password2",e)},expression:"form.password2"}})],1),t._v(" "),a("b-button",{attrs:{type:"submit",variant:"primary",disabled:!t.validated}},[t._v("Submit")]),t._v(" "),a("p",{staticClass:"mt-3"},[t._v("\n        Already have an account? "),a("router-link",{attrs:{to:"/login"}},[t._v("Log In")])],1)],1)],1)])},staticRenderFns:[]};var $=a("VU/8")(L,U,!1,function(t){a("VlMO")},null,null).exports,O={name:"ActivitySets",props:{authToken:{type:Object},isLoggedIn:{type:Boolean},user:{type:Object}},data:function(){return{allActivitySets:[],userTableFields:["logo","shortName","role","actions"],remainingTableFields:["logo","shortName","description"]}},computed:{userActivitySets:function(){var t=this;return this.isLoggedIn?c.a.filter(this.allActivitySets,function(e){return t.isEditor(e)||t.isManager(e)||t.isViewer(e)}):[]},remainingActivitySets:function(){var t=this;return this.isLoggedIn?c.a.filter(this.allActivitySets,function(e){return!t.isEditor(e)&&!t.isManager(e)&&!t.isViewer(e)}):this.allActivitySets},userActivityMeta:function(){return c.a.map(this.userActivitySets,function(t){return t.meta})},userActivityTable:function(){var t=this;return c.a.map(this.userActivityMeta,function(e,a){return{logoImage:e.logoImage,shortName:e.shortName,description:e.description,role:t.getRole(t.userActivitySets[a]).join([", "]),activityId:t.userActivitySets[a]._id}})},remainingActivityMeta:function(){return c.a.map(this.remainingActivitySets,function(t){return t.meta})},remainingActivityTable:function(){return c.a.map(this.remainingActivityMeta,function(t){return{logoImage:t.logoImage,shortName:t.shortName,description:t.description}})}},mounted:function(){var t,e=this;(t=this.authToken.token,w()({method:"GET",url:S+"/collection/?text=Volumes"}).then(function(t){return t.data[0]._id}).then(function(e){return k(e,t)})).then(function(t){e.allActivitySets=t.data})},methods:{isEditor:function(t){var e=this.user._id;return t.meta.members.editors.indexOf(e)>-1},isManager:function(t){var e=this.user._id;return t.meta.members.managers.indexOf(e)>-1},isViewer:function(t){var e=this.user._id;return _()(t.meta.members.viewers).indexOf(e)>-1},getRole:function(t){this.user._id;var e=[this.isEditor(t),this.isManager(t),this.isViewer(t)];return c.a.filter(["Editor","Manager","Viewer"],function(t,a){return e[a]})},getImageURL:function(t){return D(t)},createNewActivitySet:function(){var t,e,a=this;(t=this.user._id,e=this.authToken.token,w()({method:"GET",url:S+"/collection/?text=Volumes"}).then(function(t){return console.log("got id",t.data[0]._id),t.data[0]._id}).then(function(a){return w()({method:"POST",url:S+"/folder",params:{name:"Untitled Activity Set",metadata:{shortName:"untitled",description:"an untitled activity set",members:{editors:[t],managers:[t],users:[],viewers:[]}},parentId:a,parentType:"collection",reuseExisting:!0},headers:{"Girder-Token":""+e}})})).then(function(t){a.$router.push("edit_activity_set/"+t.data._id)})}}},E={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",{staticClass:"p-3"},[a("b-row",[a("b-col",{staticClass:"text-center"},[a("h1",[t._v("Activity Sets")]),t._v(" "),a("p",{staticClass:"lead"},[t._v("A collection of activities.")])])],1),t._v(" "),t.isLoggedIn?a("b-row",[a("b-col",[a("h2",[t._v("Your Activity Sets")]),t._v(" "),a("p",{staticClass:"lead"},[t._v("\n        Here are the activies you own, manage, or can view.\n      ")]),t._v(" "),a("b-button",{staticClass:"mb-3",attrs:{variant:"success"},on:{click:t.createNewActivitySet}},[a("i",{staticClass:"fas fa-plus mr-2"}),t._v("Create New Activity Set\n      ")]),t._v(" "),a("b-table",{attrs:{striped:"",hover:"",items:t.userActivityTable,fields:t.userTableFields},scopedSlots:t._u([{key:"logo",fn:function(e){return[e.item.logoImage?a("span",[a("img",{staticClass:"tableLogo",attrs:{src:t.getImageURL(e.item.logoImage["@id"])}})]):t._e()]}},{key:"actions",fn:function(e){return[e.item.role.indexOf("Editor")>-1?a("span",[a("b-button",{attrs:{size:"sm",variant:"secondary",to:"/edit_activity_set/"+e.item.activityId}},[t._v("\n               Edit\n             ")])],1):t._e(),t._v(" "),e.item.role.indexOf("Viewer")>-1?a("span",[a("b-button",{attrs:{size:"sm",variant:"info",to:"/view_activity/"+e.item.activityId}},[t._v("\n               View\n             ")])],1):t._e()]}}])})],1)],1):t._e(),t._v(" "),a("b-row",{staticClass:"mt-3"},[a("b-col",[a("h2",[t._v("Public Activity Sets")]),t._v(" "),a("p",{staticClass:"lead"},[t._v("\n        Here are all the other activity sets. You don't have permission to see them, though.\n      ")]),t._v(" "),a("b-table",{attrs:{striped:"",hover:"",items:t.remainingActivityTable,fields:t.remainingTableFields},scopedSlots:t._u([{key:"logo",fn:function(e){return[e.item.logoImage?a("span",[a("img",{staticClass:"tableLogo",attrs:{src:t.getImageURL(e.item.logoImage["@id"])}})]):t._e()]}}])})],1)],1)],1)},staticRenderFns:[]};var F=a("VU/8")(O,E,!1,function(t){a("KpX4")},"data-v-5e91eb2f",null).exports,z={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"layer-preloader"},[e("div",{staticClass:"loading"},[e("div",{staticClass:"loader firstColor"},[e("div",{staticClass:"loader secondColor"},[e("div",{staticClass:"loader thirdColor"})])])])])}]};var V=a("VU/8")({},z,!1,function(t){a("KXEG")},null,null).exports,G={render:function(){var t=this.$createElement;return(this._self._c||t)("h1",[this._v(" Unauthorized ")])},staticRenderFns:[]},P=a("VU/8")(null,G,!1,null,null,null).exports,B={name:"viewActivity",props:{user:{type:Object},isLoggedIn:{type:Boolean},authToken:{type:Object}},components:{Loading:V,Unauthorized:P},data:function(){return{activityData:{},status:"loading",userData:{},userSearch:""}},computed:{activityId:function(){return this.$route.params.activityId},viewableUsers:function(){return _()(this.userData)},currentRoute:function(){return this.$router.currentRoute.name},searchUsers:function(){var t=this;return this.userSearch?c.a.filter(this.viewableUsers,function(e){return(t.userData[e].firstName.toLowerCase()+t.userData[e].lastName.toLowerCase()).indexOf(t.userSearch.toLowerCase())>-1}):this.viewableUsers}},methods:{getActivitySet:function(){var t=this;return C(this.activityId).then(function(e){t.activityData=e.data})},isViewer:function(t){var e=this.user._id;return _()(t.meta.members.viewers).indexOf(e)>-1},getUserMetadata:function(t){var e=this;A(t).then(function(a){s.a.set(e.userData,t,a.data),e.$forceUpdate()})}},mounted:function(){var t=this;this.status="loading",this.getActivitySet().then(function(){t.status="complete";var e=t.activityData.meta.members.viewers[t.user._id];c.a.map(e,t.getUserMetadata),t.isViewer(t.activityData)&&t.isLoggedIn||(t.status="unauthorized")})}},q={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",["loading"===t.status?a("Loading"):"unauthorized"===t.status?a("Unauthorized"):t.isLoggedIn?a("div",{staticClass:"activitySetOverview"},[a("b-row",[a("b-col",{staticClass:"pt-3 bg-light col-md-3 col-sm-12 col-xs-12"},[a("b-nav",{staticClass:"w-100",attrs:{vertical:"",pills:""}},[t.isLoggedIn?a("b-nav-item",{attrs:{to:"/activitySets",exact:""}},[a("i",{staticClass:"fas fa-long-arrow-alt-left"}),t._v("\n          Your Activity Sets\n          ")]):t._e(),t._v(" "),a("b-nav-item",{attrs:{to:"/view_activity/"+t.activityId+"/overview"}},[t._v("\n            Overview\n          ")]),t._v(" "),a("b-nav-text",{staticClass:"text-center"},[t._v("Users")]),t._v(" "),a("b-nav-form",{staticClass:"ml-3"},[a("b-form-input",{staticClass:"mx-auto w-100",attrs:{type:"text",placeholder:"Search"},model:{value:t.userSearch,callback:function(e){t.userSearch=e},expression:"userSearch"}})],1),t._v(" "),a("div",{staticClass:"mt-3"},t._l(t.searchUsers,function(e){return a("b-nav-item",{key:e,staticClass:"w-100",attrs:{to:"/view_activity/"+t.activityId+"/view_user/"+e}},[t.userData[e]?a("span",[t.userData[e].lastName?a("span",[t._v("\n                  "+t._s(t.userData[e].lastName)+", "+t._s(t.userData[e].firstName)+"\n                 ")]):t._e()]):t._e()])}),1)],1)],1),t._v(" "),a("b-col",{staticClass:"p-3 col-md-9 col-sm-12 col-xs-12"},[a("router-view",{attrs:{activityData:t.activityData,authToken:t.authToken}})],1)],1)],1):a("Unauthorized")],1)},staticRenderFns:[]};var H=a("VU/8")(B,q,!1,function(t){a("Ct4C")},"data-v-6ef6d712",null).exports,W={name:"ActivitySetOverview",props:{activityData:{type:Object}},methods:{getImageURL:function(t){return D(t)}}},X={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",{staticClass:"minW"},[a("b-row",[a("b-col",[a("h1",{staticClass:"text-center"},[t.activityData.meta.logoImage?a("b-img",{attrs:{thumbnail:"",rounded:"",width:"75",height:"75","blank-color":"#777",src:t.getImageURL(t.activityData.meta.logoImage["@id"])}}):t._e(),t._v("\n        "+t._s(t.activityData.name)+"\n      ")],1)])],1),t._v(" "),a("b-row",[a("b-col",[a("p",{staticClass:"lead text-center"},[t._v("\n        "+t._s(t.activityData.meta.description)+"\n      ")])])],1),t._v(" "),a("b-row",[a("b-col",{staticClass:"text-center"},[a("h3",[t._v(t._s(t.activityData.meta.members.editors.length))]),t._v(" "),a("p",[t._v("Editors")])]),t._v(" "),a("b-col",{staticClass:"text-center"},[a("h3",[t._v(t._s(t.activityData.meta.members.managers.length))]),t._v(" "),a("p",[t._v("Managers")])]),t._v(" "),a("b-col",{staticClass:"text-center"},[a("h3",[t._v(t._s(t.activityData.meta.members.users.length))]),t._v(" "),a("p",[t._v("Users")])]),t._v(" "),a("b-col",{staticClass:"text-center"},[a("h3",[t._v(t._s(Object.keys(t.activityData.meta.members.viewers).length))]),t._v(" "),a("p",[t._v("Viewers")])])],1)],1)},staticRenderFns:[]};var J=a("VU/8")(W,X,!1,function(t){a("Uy0G")},null,null).exports,Y=a("PJh5"),K=a.n(Y),Z={name:"SubTable",props:{responseData:{type:Array}},methods:{extractData:function(t){return t.data?t.data.survey?t.data.survey:t.data.text?t.data.text:"FIX":null}},computed:{tableData:function(){var t=this;return c.a.filter(c.a.map(this.responseData,function(e){return{text:e.text,survey:t.extractData(e)}}),function(t){return null!=t.survey})}}},Q={render:function(){var t=this.$createElement;return(this._self._c||t)("b-table",{attrs:{striped:"",items:this.tableData,"thead-class":"hidden"}})},staticRenderFns:[]};var tt=a("VU/8")(Z,Q,!1,function(t){a("scZD")},null,null).exports,et={"Sleep Behavior":"https://us-central1-dmriprep.cloudfunctions.net/reduce_sleep_behavior"},at=a("8hZP"),st=a("vwbq");st.tip=at.a,window.d3=st;var it={name:"BarPlot",props:{data:{type:Array},xName:{type:String},yName:{type:String},height:{type:Number,default:200},padding:{type:Number,default:25},color:{type:String,default:"red"},title:{type:String,default:""}},data:function(){return{width:0,tip:null}},methods:{handleResize:function(){this.$refs.chart&&(this.width=this.$refs.chart.clientWidth)},getDateRange:function(){var t=this,e=[];return c.a.map(this.data,function(a){e.push(K()(a[t.xName]))}),{min:K.a.min(e),max:K.a.max(e)}},getXScale:function(){if(this.width){var t=this.dateRange.min,e=this.dateRange.max;return st.scaleTime().domain([t.toDate(),e.toDate()]).range([this.padding,this.width-2*this.padding])}return null},getYScale:function(){var t=this.yValueRange.min,e=this.yValueRange.max;return st.scaleLinear().domain([t,e]).range([this.height-2*this.padding,0])},drawAxis:function(){st.select(this.$refs.xAxis).call(st.axisBottom(this.xScale).ticks(5)),st.select(this.$refs.yAxis).call(st.axisLeft(this.yScale).ticks(5))},drawDots:function(){var t=this;st.select(this.$refs.g).selectAll(".dot").data(this.data).enter().append("rect").attr("class","dot"),st.select(this.$refs.g).selectAll(".dot").attr("y",function(e){return t.yScale(e[t.yName])}).attr("height",function(e){return t.height-2*t.padding-t.yScale(e[t.yName])}).attr("width","10").attr("x",function(e){return t.xScale(K()(e[t.xName]).toDate())}).attr("fill",this.color),this.tip&&st.select(this.$refs.g).selectAll(".dot").on("mouseover",this.tip.show).on("mouseout",this.tip.hide)}},computed:{xScale:function(){var t=this.getXScale();return t?this.getXScale():null},yScale:function(){var t=this.getYScale();return t?this.getYScale():null},dateRange:function(){return this.getDateRange()},yValueRange:function(){var t=this;return{min:0,max:st.max(this.data,function(e){return e[t.yName]})}}},watch:{width:function(){this.width&&this.xScale&&this.yScale&&(this.drawAxis(),this.drawDots())},data:function(){this.drawAxis(),this.drawDots()}},mounted:function(){var t=this;this.width=this.$refs.chart.clientWidth,this.$nextTick(function(){t.drawAxis(),t.drawDots();var e=st.format(".1f");t.tip=st.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return"\n        <div>"+K()(a[t.xName]).format("LL")+"</div>\n        \n        <div style='color:"+t.color+'\' class="text-center mt-1">\n          <strong>\n          '+e(a[t.yName])+"\n          </strong>\n        </div>"}),st.select(t.$refs.svg).call(t.tip)})}},nt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"chart",staticClass:"w-100"},[a("svg",{ref:"svg",attrs:{width:t.width,height:t.height}},[a("g",{ref:"g",staticClass:"activityAxis",attrs:{transform:"translate("+t.padding+", "+t.padding+")","text-anchor":"left"}},[a("g",{ref:"xAxis",attrs:{transform:"translate(0, "+(t.height-2*t.padding)+")","text-anchor":"left"}}),t._v(" "),a("g",{ref:"yAxis",attrs:{transform:"translate("+t.padding+")"}},[a("text",{attrs:{x:t.padding/2,y:0,fill:"black","text-anchor":"start"}},[t._v("\n          "+t._s(t.title)+"\n        ")])])])]),t._v(" "),a("resize-observer",{on:{notify:t.handleResize}})],1)},staticRenderFns:[]};var rt=a("VU/8")(it,nt,!1,function(t){a("pWd1")},null,null).exports;window.moment=K.a;var ot={name:"ActivityView",props:{activity:{type:Array},dateRange:{type:Array},color:{type:String,default:"red"},id:{type:String,default:"av"}},components:{SubTable:tt,BarPlot:rt},data:function(){return{tableFields:["datetime","response"],filter:null,reducedData:[],width:0,status:"ready"}},watch:{reducedData:function(){this.$refs.barplot&&(this.width=this.$refs.barplot.clientWidth)}},methods:{runReducer:function(){var t=this;this.status="loading",w()({method:"POST",url:this.reducerURL,headers:{"Content-Type":"application/json"},data:this.filteredActivity}).then(function(e){t.reducedData=e.data,t.status="ready",t.$refs.collapse.show=!0}).catch(function(t){console.log(t)})},handleResize:function(){this.$refs.barplot&&(this.width=this.$refs.barplot.clientWidth)}},mounted:function(){this.$refs.barplot&&(this.width=this.$refs.barplot.clientWidth)},computed:{activityName:function(){return this.activity[0].meta.activity.name},reducerURL:function(){return et[this.activityName]},filteredActivity:function(){var t=this,e=this.activity;return this.dateRange&&(e=c.a.filter(this.activity,function(e){var a=t.dateRange[0],s=t.dateRange[1],i=K()(e.updated);return i>=a&&i<=s.add(1,"second")})),e},stringActivity:function(){return n()(this.filteredActivity,null,2)},activityDataTable:function(){var t=this;return this.dateRange?c.a.map(c.a.filter(this.activity,function(e){var a=t.dateRange[0],s=t.dateRange[1],i=K()(e.updated);return i>=a&&i<=s.add(1,"second")}),function(t){return{datetime:K()(t.updated).format("MMM Do, Y @ h:mm A"),responses:t.meta.responses}}):c.a.map(this.activity,function(t){return{datetime:K()(t.updated).format("MMM Do, Y @ h:mm A"),responses:t.meta.responses}})}}},ct={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"scrollTable"},[a("div",{staticClass:"d1 mb-3 pb-3"},[a("div",{staticClass:"text-right w-100 mb-1"},[a("small",{staticClass:"text-right"},[t._v(t._s(t.activityDataTable.length)+" items")]),t._v(" "),a("small",{staticClass:"text-left"},[a("a",{attrs:{href:"data:application/octet-stream,"+t.stringActivity}},[t._v(" download ")])]),t._v(" "),t.reducerURL?a("b-button",{attrs:{size:"sm",disabled:"loading"===t.status},on:{click:t.runReducer}},["ready"===t.status?a("span",[t._v("run reducer")]):a("span",[t._v("loading..")])]):t._e(),t._v(" "),t.reducerURL?a("b-collapse",{ref:"collapse",staticClass:"mt-2",attrs:{id:"collapse"+t.id}},[a("b-card",[t.reducedData.length?a("div",[a("BarPlot",{key:"barplot",ref:"barplot",attrs:{data:t.reducedData,xName:"sleep_time",yName:"time_slept_hours",width:t.width,color:t.color,title:"Hours slept"}})],1):t._e()])],1):t._e()],1),t._v(" "),a("div",{staticClass:"d2 card"},[a("div",{staticClass:"d3"},[a("div",{staticClass:"d3-2"},[a("div",{staticClass:"d4"},[a("div",{staticClass:"d5"},[a("b-table",{attrs:{hover:"",items:t.activityDataTable,fields:t.tableFields},scopedSlots:t._u([{key:"response",fn:function(t){return[a("SubTable",{attrs:{responseData:t.item.responses}})]}}])})],1)])])])])])])},staticRenderFns:[]};var lt=a("VU/8")(ot,ct,!1,function(t){a("UF1y")},"data-v-768d89e9",null).exports,ut={name:"Error",props:{error:{type:Object}}},dt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("b-container",[e("b-alert",{attrs:{show:"",variant:"danger"}},[this._v(this._s(this.error.message))])],1)},staticRenderFns:[]},ht=a("VU/8")(ut,dt,!1,null,null,null).exports,vt=a("A4r5"),mt=(a("Hp3F"),a("vwbq"));window.d3=mt;var pt={name:"ActivityCalendar",props:{activity:{type:Array},width:{type:Number},tMin:{type:Object},tMax:{type:Object},idx:{type:Number},height:{type:Number,default:50},padding:{type:Number,default:5},color:{type:String,default:"red"},role:{type:String,default:"data"},title:{type:String,default:""}},data:function(){return{brush:null}},methods:{getXScale:function(){return this.tMin&&this.tMax&&this.width?mt.scaleTime().domain([this.tMin.toDate(),this.tMax.toDate()]).range([this.padding,this.width-2*this.padding]):null},drawAxis:function(){mt.select(this.$refs.g).call(mt.axisBottom(this.xScale).ticks(5))},drawDots:function(){var t=this,e="data"===this.role?"dot":"scrubDot";mt.select(this.$refs.g).selectAll("."+e).data(this.activity).enter().append("circle").attr("class",e),mt.select(this.$refs.g).selectAll("."+e).attr("cy",0).attr("cx",function(e){return t.xScale(K()(e.updated).toDate())}).attr("r",5).attr("fill",this.color)},brushed:function(){var t=mt.event.selection;if(t){var e=t.map(this.xScale.invert,this.xScale);this.$emit("setRange",e)}else this.$emit("setRange",[this.tMin,this.tMax])},drawScrub:function(){var t=mt.brushX().extent([[this.padding,0],[this.width-2*this.padding,this.height]]).on("brush end",this.brushed);this.brush=t,mt.select(this.$refs.brush).call(t)},redrawScrub:function(t,e){this.brush.on("brush end",null);var a=[this.xScale(t.toDate()),this.xScale(e.toDate())];c.a.isEqual(c.a.map(a,Math.round),c.a.map(this.xScale.range(),Math.round))?mt.select(this.$refs.brush).call(this.brush.move,null):mt.select(this.$refs.brush).call(this.brush.move,a),this.brush.on("brush end",this.brushed)}},computed:{xScale:function(){var t=this.getXScale();return t?this.getXScale():null},yTrans:function(){return this.idx*this.height}},watch:{width:function(){this.width&&this.xScale&&(this.drawAxis(),this.drawDots(),"scrub"===this.role&&this.drawScrub())},tMin:function(){this.drawAxis(),this.drawDots()},tMax:function(){this.drawAxis(),this.drawDots()}},mounted:function(){this.width&&this.xScale&&(this.drawAxis(),this.drawDots(),"scrub"===this.role&&this.drawScrub())}},ft={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("g",{ref:"g",staticClass:"activityAxis",attrs:{transform:"translate("+t.padding+", "+(t.yTrans+2*t.padding)+")","text-anchor":"left"}},[a("text",{attrs:{x:t.padding,y:-t.padding,fill:"black","text-anchor":"start"}},[t._v("\n    "+t._s(t.title)+"\n  ")]),t._v(" "),"scrub"===t.role?a("g",{ref:"brush",staticClass:"brush",attrs:{transform:"translate(0, -"+t.height/2+")"}}):t._e()])},staticRenderFns:[]};var gt=a("VU/8")(pt,ft,!1,function(t){a("sXpr")},null,null).exports;s.a.use(vt.a);var yt=a("vwbq"),bt={name:"AllActivitiesCalendar",props:{id:{type:String,required:!0},data:{type:Array},isBoss:{type:Boolean,default:!1},dateRange:{type:Array},filterDateRange:{type:Array},colorArr:{type:Array}},components:{ActivityCalendar:gt},data:function(){return{width:0,height:0,tMin:null,tMax:null,sMin:null,sMax:null,axisHeight:50,padding:15}},created:function(){if(!this.isBoss&&this.dateRange)this.tMin=this.dateRange[0],this.sMin=this.dateRange[0],this.tMax=this.dateRange[1],this.sMax=this.dateRange[1];else{var t=this.getDateRange(),e=t.min,a=t.max;this.tMin=e,this.sMin=e,this.tMax=a,this.sMax=a,this.isBoss&&this.$emit("setGlobalDateRange",[e,a])}},watch:{dateRange:function(){!this.isBoss&&this.dateRange&&(this.tMin=this.dateRange[0],this.sMin=this.dateRange[0],this.tMax=this.dateRange[1],this.sMax=this.dateRange[1])},filterDateRange:function(){this.tMin=this.filterDateRange[0],this.tMax=this.filterDateRange[1],this.$refs.scrub.redrawScrub(this.tMin,this.tMax),this.$forceUpdate()}},computed:{dataFlat:function(){var t=c.a.map([].concat.apply([],this.data),c.a.clone);return t}},methods:{handleResize:function(){this.width=this.getWidth()},getWidth:function(){return this.$refs.chart.clientWidth},setHeight:function(t){var e=t+2*this.padding;yt.select(this.$refs.chart).style("height",e+"px")},getDateRange:function(){var t=[];return c.a.map(this.data,function(e){c.a.map(e,function(e){t.push(K()(e.created))})}),{min:K.a.min(t),max:K.a.max(t)}},getColor:function(t){var e=this.colorArr||yt.schemeCategory10;return e[t%e.length]},setNewRange:function(t){var e=c.a.map(t,function(t){return K()(t.toISOString())}),a=K.a.min(e),s=K.a.max(e);this.tMin=a,this.tMax=s,this.$forceUpdate(),this.$emit("setFilterDateRange",[a,s])}},mounted:function(){this.width=this.getWidth(),this.height=this.setHeight((this.data.length+1)*this.axisHeight),this.getDateRange()}},_t={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"chart"}},[a("svg",{ref:"chart",attrs:{id:t.id}},[t._l(t.data,function(e,s){return a("activity-calendar",{key:e.name,attrs:{width:t.width,activity:e,tMin:t.tMin,tMax:t.tMax,idx:s,title:e[0].meta.activity.name,height:t.axisHeight,padding:t.padding,color:t.getColor(s)}})}),t._v(" "),a("activity-calendar",{key:"scrubber",ref:"scrub",attrs:{activity:t.dataFlat,width:t.width,tMin:t.sMin,tMax:t.sMax,idx:t.data.length,height:t.axisHeight,padding:t.padding,role:"scrub",color:"white",title:"Zoom / Pan"},on:{setRange:t.setNewRange}})],2),t._v(" "),a("resize-observer",{on:{notify:t.handleResize}})],1)},staticRenderFns:[]};var xt=a("VU/8")(bt,_t,!1,function(t){a("FdbF")},"data-v-de54c42a",null).exports,wt=a("vwbq"),St={name:"ViewActivityUser",props:{authToken:{type:Object},activityData:{type:Object}},components:{ActivityView:lt,Loading:V,Error:ht,AllActivitesCalendar:xt},computed:{userId:function(){return this.$route.params.userId},activities:function(){return c.a.groupBy(this.userData,function(t){return t.meta.activity["@id"]})},activitiesArray:function(){return c.a.map(this.activities,function(t){return t})}},data:function(){return{userMetaData:{},userData:[],status:"loading",error:{message:null,response:null},globalDateRange:null,filterDateRange:null}},methods:{getUserMetadata:function(){var t=this;return A(this.userId).then(function(e){t.userMetaData=e.data}).catch(function(e){t.error.message=e.message})},getUserData:function(){var t,e,a=this;return this.status="loading",(t=this.userId,e=this.authToken.token,w()({method:"get",url:S+"/folder?parentType=user&parentId="+t+"&name=Responses",headers:{"Girder-Token":""+e}})).then(function(t){if(!t.data.length)throw{message:"User "+a.userId+" has an empty data folder!\n              Check "+S+"/folder?parentType=user&parentId="+a.userId+"&name=Responses"};return t.data[0]._id}).then(function(t){return e=t,s=a.authToken.token,w()({method:"get",url:S+"/folder?parentType=folder&parentId="+e,headers:{"Girder-Token":""+s}});var e,s}).then(function(t){return c.a.filter(t.data,function(t){return t.name===a.activityData.name})[0]._id}).then(function(t){return e=t,s=a.authToken.token,w()({method:"get",url:S+"/item?folderId="+e+"&limit=5000",headers:{"Girder-Token":""+s}});var e,s}).then(function(t){a.userData=t.data,a.status="ready"}).catch(function(t){a.error.message=t.message,a.status="error"})},scrollTo:function(t){setTimeout(function(){location.href=t},1e3)},setGlobalDateRange:function(t){this.globalDateRange=t,this.$forceUpdate()},setFilterDateRange:function(t){this.filterDateRange=t,this.$forceUpdate()},getColorArr:function(t){return[wt.schemeCategory10[t%10]]}},watch:{userId:function(){this.status="loading",this.getUserMetadata().then(this.getUserData)}},mounted:function(){var t=this;this.getUserMetadata().then(this.getUserData).then(function(){t.$route.hash&&setTimeout(function(){return t.scrollTo(t.$route.hash)},1e3)})}},kt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",["loading"===t.status?a("Loading"):"error"===t.status?a("Error",{attrs:{error:t.error}}):a("b-container",[a("b-row",[a("b-col",{staticClass:"text-center"},[a("h1",{attrs:{id:"user"}},[t.userMetaData.gravatar_baseUrl?a("b-img",{attrs:{thumbnail:"",rounded:"",width:"75",height:"75","blank-color":"#777",src:t.userMetaData.gravatar_baseUrl}}):t._e(),t._v("\n\n          "+t._s(t.userMetaData.firstName)+" "+t._s(t.userMetaData.lastName)+"\n        ")],1),t._v(" "),a("p",{staticClass:"lead"},[t._v(t._s(t.userMetaData.login))])])],1),t._v(" "),a("b-row",{staticClass:"mb-3"},[a("b-col",[a("all-activites-calendar",{attrs:{id:"chart__"+t.userId,data:t.activitiesArray,isBoss:!0,filterDateRange:t.filterDateRange},on:{setGlobalDateRange:t.setGlobalDateRange,setFilterDateRange:t.setFilterDateRange}})],1)],1),t._v(" "),a("b-row",{staticClass:"mt-3"},[a("b-col",[a("h5",[t._v(" Activities in "+t._s(t.activityData.name)+": ")])]),t._v(" "),a("b-col",{attrs:{offset:"1",cols:"11"}},t._l(t.activities,function(e){return a("div",{key:e._id,staticClass:"mt-3"},[a("p",[a("a",{attrs:{href:"#"+e[0].meta.activity.name}},[t._v("\n                "+t._s(e[0].meta.activity.name)+" ("+t._s(e.length)+")\n              ")])])])}),0)],1),t._v(" "),a("b-row",[a("b-col",t._l(t.activitiesArray,function(e,s){return a("div",{key:e._id,staticClass:"mt-2"},[a("h2",{staticClass:"mb-0 pb-0",attrs:{id:e[0].meta.activity.name}},[t._v("\n            "+t._s(e[0].meta.activity.name)+" ("+t._s(e.length)+")\n          ")]),t._v(" "),a("div",{staticClass:"mb-3"},[a("small",[a("a",{attrs:{href:"#user"}},[t._v("go to top")])])]),t._v(" "),a("all-activites-calendar",{attrs:{id:"subchart__"+s,data:[e],dateRange:t.globalDateRange,filterDateRange:t.filterDateRange,colorArr:t.getColorArr(s)},on:{setFilterDateRange:t.setFilterDateRange}}),t._v(" "),a("ActivityView",{attrs:{activity:e,dateRange:t.filterDateRange,color:t.getColorArr(s)[0]}})],1)}),0)],1)],1)],1)},staticRenderFns:[]};var Dt=a("VU/8")(St,kt,!1,function(t){a("e24b")},"data-v-5c418920",null).exports,Ct={name:"forgot",data:function(){return{form:{email:null,password:null},errors:{message:null,show:!1,code:null}}},methods:{onSubmit:function(t){var e,a=this;t.preventDefault(),(e={email:this.form.email},w()({method:"PUT",url:S+"/user/password/temporary",params:e})).then(function(t){console.log("response from forgot",t)}).catch(function(t){a.errors.code=t.response,401===a.errors.code.status?a.errors.message="We have no record of your email. Please create a new account!":a.errors.message=t.message,a.errors.show=!0})}}},Tt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"text-center",attrs:{id:"forgot"}},[a("h1",[t._v(" Reset Password ")]),t._v(" "),a("div",{staticClass:"container fluid",attrs:{id:"forgotForm"}},[a("b-alert",{attrs:{show:t.errors.show,variant:"danger"}},[t._v(t._s(t.errors.message))]),t._v(" "),a("b-form",{on:{submit:t.onSubmit}},[a("b-form-group",{attrs:{id:"usernameInputGroup",label:"Email address:","label-for":"email"}},[a("b-form-input",{attrs:{id:"email",required:"",placeholder:"Enter email"},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),t._v(" "),a("b-button",{attrs:{type:"submit",variant:"primary"}},[t._v("Submit")])],1)],1)])},staticRenderFns:[]};var It=a("VU/8")(Ct,Tt,!1,function(t){a("dG3h")},null,null).exports,jt=a("Gu7T"),At=a.n(jt),Rt=a("kwpM"),Nt=a.n(Rt);s.a.use(Nt.a);var Mt={props:["value","placeholder","index","ttype"],template:'\n  <div>\n    <input ref="input" class="textfield" \n     v-autowidth="{minWidth: \'100px\', comfortZone: 10}" \n     :value="value" :placeholder="getPlaceholder()" \n     v-on:input="onInput" v-if="ttype==\'text\'"\n     v-on:change="onChange"\n    >\n    <textarea v-on:change="onChange" \n    class="textfield text-center" \n    :value="value" \n    :placeholder="getPlaceholder()" \n    v-on:input="onInput" v-else>\n    </textarea>\n  </div>\n  ',computed:{style:function(){var t=20*this.value.length;return t<200?t="200px":t+="px",{width:t}}},methods:{onChange:function(){this.$emit("change",this.value)},onInput:function(t){var e=t.target.value;this.$emit("input",e,this.index),this.$emit("needsSave",!0)},getPlaceholder:function(){return!this.value&&this.placeholder?this.placeholder:""}}},Lt={name:"ScreenEditor",props:{screenData:{type:Object},screenName:{type:String},allScreenNames:{type:Array}},components:{Textfield:Mt},data:function(){return{text:"",name:"",nameState:!0,surveyListFields:["text","type","actions"],surveyListOptions:[],skippable:null,tableRowNames:[],tableColNames:[],tableFields:["name","action"],surveyType:null,surveyTypeOptions:[{value:"list",text:"list"},{value:"table",text:"table"},{value:"slider",text:"slider"},{value:"infoScreen",text:"infoScreen"},{value:"time",text:"time"}]}},methods:{setSurveyListOptions:function(){this.surveyListOptions=[],"list"!==this.screenData.surveyType&&"slider"!==this.screenData.surveyType||(this.surveyListOptions=[].concat(At()(this.screenData.survey.options)))},updateSurveyList:function(){var t=y()({},this.screenData.survey);t.options=this.surveyListOptions,this.$emit("changedValue","survey",t)},setSurveyListText:function(t,e){this.surveyListOptions[e].text=t,this.updateSurveyList()},removeSurvetListOption:function(t){this.surveyListOptions.splice(t.index,1)},addSurveyListOption:function(){this.surveyListOptions.push({text:"option "+this.surveyListOptions.length,type:"text"}),this.updateSurveyList()},setSurveyTable:function(){this.tableRowNames=[],this.tableColNames=[],"table"===this.screenData.surveyType&&(this.tableRowNames=c.a.map(this.screenData.survey.rows,function(t){return{name:t}}),this.tableColNames=c.a.map(this.screenData.survey.cols,function(t){return{name:t}}))},updateSurveyTable:function(){var t=y()({},this.screenData.survey);t.rows=c.a.map(this.tableRowNames,function(t){return t.name}),t.cols=c.a.map(this.tableColNames,function(t){return t.name}),this.$emit("changedValue","survey",t)},setTableRowName:function(t,e){this.tableRowNames[e].name=t,this.updateSurveyTable()},setTableColName:function(t,e){this.tableColNames[e].name=t,this.updateSurveyTable()},removeTableCol:function(t){this.tableColNames.splice(t.index,1),this.updateSurveyTable()},removeTableRow:function(t){this.tableRowNames.splice(t.index,1),this.updateSurveyTable()},addTableRowName:function(){this.tableRowNames.push({name:"row "+this.tableRowNames.length}),this.updateSurveyTable()},addTableColName:function(){this.tableColNames.push({name:"col "+this.tableColNames.length}),this.updateSurveyTable()},updateName:function(){var t=this;c.a.filter(this.allScreenNames,function(e){return e.name===t.name}).length?this.nameState=!1:(this.$emit("changedName",this.name),this.nameState=!0)}},watch:{text:function(){this.$emit("changedValue","text",this.text)},surveyType:function(){this.$emit("changedValue","surveyType",this.surveyType)},skippable:function(){this.$emit("changedValue","skippable",this.skippable)},screenData:function(){this.text=this.screenData.text,this.skippable=this.screenData.skippable,this.surveyType=this.screenData.surveyType,this.setSurveyListOptions(),this.setSurveyTable()},screenName:function(){this.name=this.screenName}},mounted:function(){this.text=this.screenData.text,this.name=this.screenName,this.skippable=this.screenData.skippable,this.surveyType=this.screenData.surveyType,this.setSurveyListOptions(),this.setSurveyTable()}},Ut={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[a("b-row",{staticClass:"my-1"},[a("b-col",{staticClass:"text-right",attrs:{sm:"2"}},[a("label",{attrs:{for:"type-text"}},[t._v("Screen Id:")])]),t._v(" "),a("b-col",{attrs:{sm:"10"}},[a("b-form-group",[a("b-form-input",{attrs:{id:"type-text",type:"text",rows:3,state:t.nameState,"aria-describedby":"inputLiveHelp inputLiveFeedback"},on:{change:t.updateName},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}},[a("b-form-invalid-feedback",{attrs:{id:"inputLiveFeedback"}},[t._v("\n          This name is taken. Choose another.\n        ")]),t._v(" "),a("b-form-text",{attrs:{id:"inputLiveHelp"}},[t._v("\n          This needs to be a unique name\n        ")])],1)],1)],1)],1),t._v(" "),a("b-row",{staticClass:"my-1"},[a("b-col",{staticClass:"text-right",attrs:{sm:"2"}},[a("label",{attrs:{for:"type-text"}},[t._v("Text:")])]),t._v(" "),a("b-col",{attrs:{sm:"10"}},[a("b-form-textarea",{attrs:{id:"type-text",type:"text",rows:3},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}})],1)],1),t._v(" "),a("b-row",{staticClass:"my-1 mt-3"},[a("b-col",{staticClass:"text-center",attrs:{sm:"12"}},[a("b-form-checkbox",{attrs:{id:"skippable",value:!0,"unchecked-value":!1},model:{value:t.skippable,callback:function(e){t.skippable=e},expression:"skippable"}},[t._v("\n        This question can be skipped.\n      ")])],1)],1),t._v(" "),a("b-row",{staticClass:"mt-3"},[a("b-col",{staticClass:"text-right",attrs:{sm:"2"}},[a("label",{attrs:{for:"type-survey"}},[t._v("Survey Type:")])]),t._v(" "),a("b-col",{attrs:{sm:"10"}},[a("b-form-select",{staticClass:"mb-3",attrs:{options:t.surveyTypeOptions,id:"type-survey"},model:{value:t.surveyType,callback:function(e){t.surveyType=e},expression:"surveyType"}})],1)],1),t._v(" "),"list"===t.screenData.surveyType?a("b-row",{staticClass:"mt-3"},[a("b-col",{staticClass:"text-right",attrs:{sm:"2"}},[a("label",{attrs:{for:"optionTable"}},[t._v("List Options:")])]),t._v(" "),a("b-col",{attrs:{sm:"10"}},[a("b-table",{attrs:{id:"optionTable",items:t.surveyListOptions,fields:t.surveyListFields},scopedSlots:t._u([{key:"text",fn:function(e){return[a("textfield",{attrs:{index:e.index,ttype:"text"},on:{input:t.setSurveyListText},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"data.value"}})]}},{key:"actions",fn:function(e){return[a("button",{staticClass:"close",staticStyle:{width:"100%"},attrs:{type:"button","aria-label":"Close"},on:{click:function(a){return t.removeSurvetListOption(e)}}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])]}}])}),t._v(" "),a("b-button",{staticClass:"w-100",attrs:{variant:"outline-primary"},on:{click:t.addSurveyListOption}},[t._v("\n          Add Option\n        ")])],1)],1):t._e(),t._v(" "),"slider"===t.screenData.surveyType?a("b-row",{staticClass:"mt-3"},[a("b-col",{staticClass:"text-right",attrs:{sm:"2"}},[a("label",{attrs:{for:"optionTable"}},[t._v("Slider Options:")])]),t._v(" "),a("b-col",{attrs:{sm:"10"}},[a("b-table",{ref:"listTable",attrs:{id:"optionTable",items:t.surveyListOptions,fields:t.surveyListFields},scopedSlots:t._u([{key:"text",fn:function(e){return[a("textfield",{attrs:{index:e.index,ttype:"text"},on:{input:t.setSurveyListText},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"data.value"}})]}},{key:"actions",fn:function(e){return[a("button",{staticClass:"close",staticStyle:{width:"100%"},attrs:{type:"button","aria-label":"Close"},on:{click:function(a){return t.removeSurvetListOption(e)}}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])]}}])}),t._v(" "),a("b-button",{staticClass:"w-100",attrs:{variant:"outline-primary"},on:{click:t.addSurveyListOption}},[t._v("\n          Add Option\n        ")])],1)],1):t._e(),t._v(" "),"table"===t.screenData.surveyType?a("b-row",{staticClass:"mt-3"},[a("b-col",{staticClass:"text-right",attrs:{sm:"2"}},[a("label",{attrs:{for:"type-text"}},[t._v("Table Rows:")])]),t._v(" "),a("b-col",{attrs:{sm:"10"}},[a("b-table",{attrs:{items:t.tableRowNames,fields:t.tableFields,striped:""},scopedSlots:t._u([{key:"name",fn:function(e){return[a("textfield",{attrs:{index:e.index,ttype:"text"},on:{input:t.setTableRowName},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"data.value"}})]}},{key:"action",fn:function(e){return[e.index?a("button",{staticClass:"close",staticStyle:{width:"100%"},attrs:{type:"button","aria-label":"Close"},on:{click:function(a){return t.removeTableRow(e)}}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])]):t._e()]}}])}),t._v(" "),a("b-button",{staticClass:"w-100",attrs:{variant:"outline-primary"},on:{click:t.addTableRowName}},[t._v("\n          Add row name\n        ")])],1)],1):t._e(),t._v(" "),"table"===t.screenData.surveyType?a("b-row",{staticClass:"mt-3"},[a("b-col",{staticClass:"text-right",attrs:{sm:"2"}},[a("label",{attrs:{for:"type-text"}},[t._v("Table Columns:")])]),t._v(" "),a("b-col",{attrs:{sm:"10"}},[a("b-table",{attrs:{items:t.tableColNames,fields:t.tableFields,striped:""},scopedSlots:t._u([{key:"name",fn:function(e){return[a("textfield",{attrs:{index:e.index,ttype:"text"},on:{input:t.setTableColName},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"data.value"}})]}},{key:"action",fn:function(e){return[e.index?a("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:function(a){return t.removeTableCol(e)}}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("× ")])]):t._e()]}}])}),t._v(" "),a("b-button",{staticClass:"w-100",attrs:{variant:"outline-primary"},on:{click:t.addTableColName}},[t._v("\n          Add column name\n        ")])],1)],1):t._e(),t._v(" "),a("b-row",{staticClass:"mt-3"},[a("b-col",[a("h5",{staticClass:"text-muted text-center"},[t._v(" data schema ")]),t._v(" "),a("p",{staticClass:"text-center text-muted"},[a("small",[t._v("this is for development purposes. ")])]),t._v(" "),a("p",[t._v(t._s(t.screenData))])])],1)],1)])},staticRenderFns:[]};var $t=a("VU/8")(Lt,Ut,!1,function(t){a("XEh3")},null,null).exports,Ot={name:"EditActivitySet",props:{user:{type:Object},isLoggedIn:{type:Boolean},authToken:{type:Object},activitySetId:{type:String}},components:{Loading:V,Unauthorized:P,ActivitySetOverview:J,Textfield:Mt},data:function(){return{activityData:{},status:"loading",userData:{},userSearch:"",activities:[],activitiesMetadata:{},activityTableFields:[{key:"name",sortable:!0},{key:"screens",sortable:!0},{key:"actions"}]}},computed:{activityId:function(){return this.activitySetId},authorized:function(){if(this.activityData&&this.activityData.meta){var t=this.isEditor(this.activityData),e=this.isManager(this.activityData);return t||e}return"loading"===this.status},activitiesTable:function(){var t=this;return c.a.map(this.activities,function(e,a){var s="",i=null,n=null;return t.activitiesMetadata[a]&&(s=t.activitiesMetadata[a].meta.description,i=t.activitiesMetadata[a].meta.screens.length,n=e._id),{name:e.name,description:s,screens:i,id:n}})}},methods:{getImageURL:function(t){return D(t)},getActivitySet:function(){var t=this;return C(this.activityId,this.authToken.token).then(function(e){return t.activityData=e.data,t.activityData._id}).then(function(e){return I(e,t.authToken.token)}).then(function(e){console.log("got some activities",e.data),t.activities=e.data,c.a.map(e.data,function(e,a){T(e._id,t.authToken.token).then(function(e){if(e.data.length){var i=e.data[0];i.meta.screens||(i.meta.screens=[]),s.a.set(t.activitiesMetadata,a,i),t.$forceUpdate()}})})}).catch(function(t){console.log("error in get activity set",t)})},getUserMetadata:function(t){var e=this;A(t).then(function(a){s.a.set(e.userData,t,a.data),e.$forceUpdate()})},isEditor:function(t){var e=this.user._id;return t.meta.members.editors.indexOf(e)>-1},isManager:function(t){var e=this.user._id;return t.meta.members.managers.indexOf(e)>-1},isViewer:function(t){var e=this.user._id;return _()(t.meta.members.viewers).indexOf(e)>-1},updateMetadata:function(){(function(t){var e=t.name,a=t.metadata,s=t.parentId,i=t.token;return w()({method:"PUT",url:S+"/folder/"+s,headers:{"Girder-Token":""+i},params:{name:e,metadata:a}})})({name:this.activityData.name,metadata:this.activityData.meta,parentId:this.activityId,token:this.authToken.token}).then(function(){}).catch(function(t){console.log("error in update metadata",t)})},createNewActivity:function(){var t,e,a,s,i=this;(t={name:"untitled activity",parentId:this.activityId,token:this.authToken.token},e=t.name,a=t.parentId,s=t.token,w()({method:"GET",url:S+"/folder?parentId="+a+"&parentType=folder",headers:{"Girder-Token":""+s}}).then(function(t){var e=c.a.filter(t.data,function(t){return"Activities"===t.name});if(e.length)return e[0]._id;console.log("creating the folder");var i=new FormData;return i.set("name","Activities"),i.set("parentId",a),i.set("parentType","folder"),i.set("reuseExisting",!0),i.set("metadata",n()({})),w()({method:"POST",url:S+"/folder",headers:{"Girder-Token":""+s},data:i}).then(function(t){return t.data._id})}).then(function(t){console.log("activities folder id is",t);var a=new FormData;return a.set("name",e),a.set("parentId",t),a.set("parentType","folder"),a.set("reuseExisting",!0),a.set("metadata",n()({})),w()({method:"POST",url:S+"/folder/",headers:{"Girder-Token":""+s},data:a})})).then(function(t){i.$router.push(i.activityId+"/edit_activity/"+t.data._id)}).catch(function(t){console.log("error in create new activity",t)})}},mounted:function(){var t=this;this.status="loading",this.getActivitySet().then(function(){t.status="complete"})}},Et={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.authorized?t._e():a("Unauthorized"),t._v(" "),"loading"===t.status?a("Loading"):a("div",{staticClass:"main container"},[a("p",{staticClass:"lead text-muted text-center mt-3"},[t._v("Edit Activity Set ")]),t._v(" "),a("h1",{staticClass:"text-center mt-3"},[t.activityData.meta.logoImage?a("b-img",{attrs:{thumbnail:"",rounded:"",width:"75",height:"75","blank-color":"#777",src:t.getImageURL(t.activityData.meta.logoImage["@id"])}}):t._e(),t._v(" "),a("textfield",{attrs:{ttype:"text",placeholder:"short name"},on:{change:t.updateMetadata},model:{value:t.activityData.meta.shortName,callback:function(e){t.$set(t.activityData.meta,"shortName",e)},expression:"activityData.meta.shortName"}})],1),t._v(" "),a("p",{staticClass:"lead text-center"},[a("textfield",{attrs:{ttype:"text",placeholder:"name"},on:{change:t.updateMetadata},model:{value:t.activityData.name,callback:function(e){t.$set(t.activityData,"name",e)},expression:"activityData.name"}})],1),t._v(" "),a("b-row",[a("b-col",[a("p",{staticClass:"lead text-center"},[a("textfield",{attrs:{ttype:"text",placeholder:"description"},on:{change:t.updateMetadata},model:{value:t.activityData.meta.description,callback:function(e){t.$set(t.activityData.meta,"description",e)},expression:"activityData.meta.description"}})],1)])],1),t._v(" "),a("b-row",[a("b-col",{staticClass:"text-center"},[a("h3",[t._v(t._s(t.activityData.meta.members.editors.length))]),t._v(" "),a("p",[t._v("Editors")])]),t._v(" "),a("b-col",{staticClass:"text-center"},[a("h3",[t._v(t._s(t.activityData.meta.members.managers.length))]),t._v(" "),a("p",[t._v("Managers")])]),t._v(" "),a("b-col",{staticClass:"text-center"},[a("h3",[t._v(t._s(t.activityData.meta.members.users.length))]),t._v(" "),a("p",[t._v("Users")])]),t._v(" "),a("b-col",{staticClass:"text-center"},[a("h3",[t._v(t._s(Object.keys(t.activityData.meta.members.viewers).length))]),t._v(" "),a("p",[t._v("Viewers")])]),t._v(" "),a("b-col",{staticClass:"text-center"},[a("h3",[t._v(t._s(t.activities.length))]),t._v(" "),a("p",[t._v("Activities")])])],1),t._v(" "),a("b-row",{staticClass:"mt-3"},[a("b-col",[a("h3",[t._v(" Activities ")]),t._v(" "),a("p",[t._v("in this activity set are:")]),t._v(" "),a("b-button",{staticClass:"mb-3",attrs:{variant:"success"},on:{click:t.createNewActivity}},[a("i",{staticClass:"fas fa-plus mr-2"}),t._v("Create New Activity\n        ")]),t._v(" "),a("b-table",{attrs:{striped:"",hover:"",outlined:"",responsive:"",items:t.activitiesTable,fields:t.activityTableFields},scopedSlots:t._u([{key:"name",fn:function(e){return[null!=e.item.id?a("span",[a("router-link",{attrs:{to:"/edit_activity_set/"+t.activityId+"/edit_activity/"+e.item.id}},[t._v("\n                "+t._s(e.item.name)+"\n              ")])],1):a("span",[t._v("\n              "+t._s(e.item.name)+" (error) "+t._s(e.item)+"\n            ")])]}},{key:"actions",fn:function(e){return[a("b-button",{staticClass:"close",attrs:{size:"sm","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("× ")])])]}}])})],1)],1),t._v(" "),a("b-row",{staticClass:"mt-3"},[a("b-col",[a("h3",[t._v(" Role Management ")]),t._v(" "),a("p",[t._v(" Add/remove editors, managers, viewers, and users")]),t._v(" "),a("b-card",{attrs:{"no-body":""}},[a("b-tabs",{attrs:{card:""}},[a("b-tab",{attrs:{title:"editors",active:""}},[t._v("\n              editors\n            ")]),t._v(" "),a("b-tab",{attrs:{title:"managers"}},[t._v("\n              managers\n            ")]),t._v(" "),a("b-tab",{attrs:{title:"users"}},[t._v("\n              users\n            ")]),t._v(" "),a("b-tab",{attrs:{title:"viewers"}},[t._v("\n              viewers\n            ")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var Ft=a("VU/8")(Ot,Et,!1,function(t){a("Jtxc")},"data-v-63227ec0",null).exports,zt=(a("v2ns"),a("7QTg")),Vt=a("GDE4"),Gt=a.n(Vt),Pt=a("oUIx"),Bt=a.n(Pt);a("7w68");s.a.component("VueCtkDateTimePicker",Bt.a);var qt={name:"ScreenPreview",props:{screenData:{type:Object}},components:{vueSlider:Gt.a},computed:{surveyTable:function(){var t=this;return"table"===this.screenData.surveyType?c.a.map(this.screenData.survey.rows,function(e){var a={"   ":e};return t.screenData.survey.cols.forEach(function(t){a[t]="________"}),a}):[]},sliderOptions:function(){var t=c.a.map(this.screenData.survey.options,function(t){return t.text}),e="Discrete"===this.screenData.survey.increments;return{direction:this.screenData.survey.orientation,height:100,width:4,style:{display:"inline-block",marginLeft:"50px"},data:t,piecewise:e,piecewiseLabel:!0,tooltip:!1}}}},Ht={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-card",{staticClass:"mb-2 preview",staticStyle:{"max-width":"20rem"},attrs:{"footer-tag":"footer",tag:"article"}},[a("p",{staticClass:"card-text lh"},[t._v("\n    "+t._s(t.screenData.text)+"\n  ")]),t._v(" "),a("div",{staticClass:"card-text"},["list"===t.screenData.surveyType?a("div",[a("b-form-group",[a("b-form-radio-group",{attrs:{options:t.screenData.survey.options,stacked:"",disabled:"",name:"radiosStacked"}})],1)],1):t._e(),t._v(" "),"table"===t.screenData.surveyType?a("div",[a("b-table",{staticClass:"specialTable",attrs:{items:t.surveyTable,small:"",outlined:"",striped:""}})],1):t._e(),t._v(" "),"slider"===t.screenData.surveyType?a("div",{},[a("vue-slider",t._b({ref:"slider"},"vue-slider",t.sliderOptions,!1))],1):t._e(),t._v(" "),"time"===t.screenData.surveyType?a("div",[a("VueCtkDateTimePicker",{attrs:{onlyTime:"",disabled:"",label:"select time"}})],1):t._e()]),t._v(" "),a("em",{attrs:{slot:"footer"},slot:"footer"},[a("b-row",[a("b-col",{staticClass:"text-right"},[t.screenData.skippable?a("b-button",{attrs:{size:"sm",disabled:"",variant:"default"}},[t._v("\n          Skip\n        ")]):t._e()],1)],1)],1)])},staticRenderFns:[]};var Wt=a("VU/8")(qt,Ht,!1,function(t){a("jwgv")},null,null).exports;var Xt=function(){return{name:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e="screenName_",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=0;s<t;s+=1)e+=a.charAt(Math.floor(Math.random()*a.length));return e}(10),meta:{surveyType:"list",skippable:!0,survey:{increments:"Discrete",orientation:"vertical",mode:"single",options:[]},text:""}}},Jt={name:"EditActivity",props:{user:{type:Object},isLoggedIn:{type:Boolean},authToken:{type:Object},activitySetId:{type:String}},data:function(){return{activitySetData:{},activityData:{meta:{shortName:"untitled activity",description:"add a description"},name:"full name of untitled activity"},status:"loading",screens:[],swiperReady:!1,swiperOption:{slidesPerView:6,spaceBetween:30,centeredSlides:!0,mousewheel:!1,grabCursor:!0,keyboard:{enabled:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{1360:{slidesPerView:4,spaceBetween:20},950:{slidesPerView:3,spaceBetween:20},680:{slidesPerView:2,spaceBetween:20},450:{slidesPerView:1,spaceBetween:10}}}}},components:{Loading:V,Unauthorized:P,swiper:zt.swiper,swiperSlide:zt.swiperSlide,ScreenEditor:$t,ScreenPreview:Wt,Textfield:Mt},computed:{currentSlide:function(){return this.swiperReady?this.$refs.swiper.swiper.activeIndex:null},activityId:function(){return this.$route.params.activityId},authorized:function(){return this.activitySetData&&this.activitySetData.meta?this.isEditor(this.activitySetData):"loading"===this.status},currentScreenIndex:function(){return this.getIndex(this.activityData.meta.screens[this.currentSlide])}},methods:{isEditor:function(t){var e=this.user._id;return t.meta.members.editors.indexOf(e)>-1},getActivitySet:function(){var t=this;return C(this.activitySetId,this.authToken.token).then(function(e){console.log("activity set data",e),t.activitySetData=e.data}).catch(function(t){console.log("error in getActivitySet",t)})},getUserMetadata:function(t){var e=this;A(t).then(function(a){s.a.set(e.userData,t,a.data),e.$forceUpdate()})},getActivityMetadata:function(){var t=this;return T(this.activityId,this.authToken.token).then(function(e){return e.data.length?(t.activityData=e.data[0],_()(t.activityData).indexOf("meta")<0&&(t.activityData.meta={screens:[]}),t.status="ready",e.data[0]._id):(a={name:t.activityData.name,id:t.activityId,token:t.authToken.token},s=a.name,i=a.id,r=a.token,o=new FormData,o.set("name",s),o.set("parentId",i),o.set("parentType","folder"),o.set("reuseExisting",!0),o.set("metadata",n()({})),w()({method:"POST",url:S+"/folder",data:o,headers:{"Girder-Token":""+r}}).then(function(t){return console.log("response from initialize",t.data),t})).then(function(e){return t.activityData=e.data,_()(t.activityData).indexOf("meta")<0&&(t.activityData.meta={screens:[]}),t.status="ready",t.activityData._id});var a,s,i,r,o}).catch(function(t){console.log("error in getActivityMetadata",t)})},getScreenMetadata:function(t){var e,a,s=this;if(t)(e=t,a=this.authToken.token,w()({method:"GET",url:S+"/item?folderId="+e,headers:{"Girder-Token":""+a}})).then(function(t){var e=c.a.map(t.data,function(t){var e=_()(t.meta),a=y()({},t);return e.indexOf("text")<0&&(a.meta.text=""),e.indexOf("surveyType")<0&&(a.meta.surveyType="infoScreen"),a.meta.surveyType||(a.meta.surveyType="infoScreen"),e.indexOf("survey")<0&&(a.meta.survey={increments:"Discrete",orientation:"vertical",mode:"single",options:[]}),a});s.screens=e}).catch(function(t){console.log("error in getScreenMetadata",t)});else{console.log("there are not any screens yet. initializing one now.");var i=Xt();this.addScreen(i.name).then(function(t){s.screens.push(i);var e={id:"item/"+t.data._id,name:i.name};return s.activityData.meta.screens=[e],s.updateMetadata()})}},updateScreen:function(t,e){_()(this.screens[this.currentScreenIndex].meta).indexOf(t)<0?(this.screens[this.currentScreenIndex].meta[t]=e,s.a.set(this.screens[this.currentScreenIndex].meta,t,e),this.$forceUpdate()):this.screens[this.currentScreenIndex].meta[t]=e,this.updateCurrentScreen()},getIndex:function(t){if(t){var e=t.name,a=c.a.filter(this.screens,function(t){return t.name===e});return c.a.indexOf(this.screens,a[0])}return 0},addScreen:function(t){return function(t){var e=t.name,a=t.folderId,s=t.token,i=new FormData;return i.set("name",e),i.set("folderId",a),i.set("metadata",n()({skippable:!0})),w()({method:"POST",url:S+"/item",headers:{"Girder-Token":""+s},data:i})}({name:t,folderId:this.activityData._id,token:this.authToken.token})},addBefore:function(){var t=this,e=Xt();this.addScreen(e.name).then(function(a){console.log("response from addScreen is",a),t.screens.push(e);var s={id:"item/"+a.data._id,name:e.name};return t.activityData.meta.screens.splice(t.currentSlide,0,s),t.updateMetadata()})},addAfter:function(){var t=this,e=Xt();console.log("adding after"),this.addScreen(e.name).then(function(a){console.log("adding screen"),t.screens.push(e);var s={id:"item/"+a.data._id,name:e.name};return t.activityData.meta.screens||(t.activityData.meta.screens=[]),t.activityData.meta.screens.splice(t.currentSlide+1,0,s),t.$refs.swiper.swiper.activeIndex+=1,t.updateMetadata()})},removeScreen:function(){this.screens.splice(this.currentScreenIndex,1),this.activityData.meta.screens.splice(this.currentSlide,1),s.a.set(this.activityData.meta,"screens",[].concat(At()(this.activityData.meta.screens)))},moveRight:function(){var t=this.activityData.meta.screens,e=[t[this.currentSlide+1],t[this.currentSlide]];t[this.currentSlide]=e[0],t[this.currentSlide+1]=e[1],this.$refs.swiper.swiper.activeIndex+=1,this.$forceUpdate()},moveLeft:function(){var t=this.activityData.meta.screens,e=[t[this.currentSlide-1],t[this.currentSlide]];t[this.currentSlide]=e[0],t[this.currentSlide-1]=e[1],this.$refs.swiper.swiper.activeIndex-=1,this.$forceUpdate()},updateScreenName:function(t){var e=this.currentScreenIndex;this.activityData.meta.screens[this.currentSlide].name=t,this.screens[e].name=t},updateCurrentScreen:function(){var t,e,a,s,i,r,o=this;this.activityData.meta.screens[this.currentSlide].id&&(t={name:this.activityData.meta.screens[this.currentSlide].name,metadata:this.screens[this.currentScreenIndex].meta,screenPath:this.activityData.meta.screens[this.currentSlide].id,token:this.authToken.token},e=t.name,a=t.metadata,s=t.screenPath,i=t.token,r=new FormData,r.set("name",e),r.set("metadata",n()(a)),w()({method:"PUT",url:S+"/"+s,headers:{"Girder-Token":""+i},data:r})).then(function(t){console.log("updated screen",t),o.updateMetadata()})},updateMetadata:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];j({name:this.activityData.name,metadata:this.activityData.meta,parentId:this.activityData._id,token:this.authToken.token}).then(function(){return e?t.updateMetadataName():0})},updateMetadataName:function(){j({name:this.activityData.name,metadata:{},parentId:this.activityId,token:this.authToken.token}).then(function(t){console.log(t)})}},mounted:function(){this.getActivityMetadata().then(this.getScreenMetadata),this.getActivitySet()}},Yt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mt-3"},["loading"===t.status?a("Loading"):t.authorized?a("div",[a("span",[a("b-button",{attrs:{to:"/edit_activity_set/"+this.activitySetId,variant:"default",size:"sm"}},[a("i",{staticClass:"fas fa-long-arrow-alt-left"}),t._v("\n        Back to Activity Set: "+t._s(t.activitySetData.meta.shortName)+"\n      ")])],1),t._v(" "),a("b-container",[a("b-row",[a("b-col",[a("h2",{staticClass:"text-center"},[a("span",{staticClass:"text-muted"},[t._v("Editing ")]),t._v(" "),a("textfield",{attrs:{ttype:"text",placeholder:"title"},on:{change:function(e){return t.updateMetadata(1)}},model:{value:t.activityData.name,callback:function(e){t.$set(t.activityData,"name",e)},expression:"activityData.name"}})],1),t._v(" "),a("p",{staticClass:"lead text-center"},[a("textfield",{attrs:{ttype:"text",placeholder:"short name"},on:{change:t.updateMetadata},model:{value:t.activityData.meta.shortName,callback:function(e){t.$set(t.activityData.meta,"shortName",e)},expression:"activityData.meta.shortName"}})],1),t._v(" "),a("p",{staticClass:"lead text-center"},[a("textfield",{attrs:{ttype:"textarea",placeholder:"description"},on:{change:t.updateMetadata},model:{value:t.activityData.meta.description,callback:function(e){t.$set(t.activityData.meta,"description",e)},expression:"activityData.meta.description"}})],1)])],1),t._v(" "),a("b-row",{staticClass:"mt3"},[a("b-col",[a("b-card",{staticClass:"mb-1",attrs:{"no-body":""}},[a("b-card-header",{staticClass:"p-1",attrs:{"header-tag":"header",role:"tab"}},[a("b-btn",{directives:[{name:"b-toggle",rawName:"v-b-toggle.accordion1",modifiers:{accordion1:!0}}],attrs:{block:"",href:"#",variant:"light"}},[a("i",{staticClass:"fas fa-sliders-h"}),t._v(" settings\n              ")])],1),t._v(" "),a("b-collapse",{attrs:{id:"accordion1",accordion:"my-accordion",role:"tabpanel"}},[a("b-card-body",[a("p",{staticClass:"card-text"},[t._v("\n                  "+t._s(t.activityData.meta)+"\n                ")])])],1)],1)],1)],1)],1),t._v(" "),a("b-row",{staticClass:"mt-3 sticky"},[a("b-col",[a("swiper",{ref:"swiper",staticClass:"bg-light pt-2",attrs:{options:t.swiperOption},on:{ready:function(e){t.swiperReady=!0}}},[t._l(t.activityData.meta.screens,function(e){return a("swiper-slide",{key:e.name},[a("small",[t._v(t._s(e.name.slice(0,20)))]),t._v(" "),t.screens[t.getIndex(e)]?a("div",[a("screen-preview",{attrs:{screenData:t.screens[t.getIndex(e)].meta}})],1):t._e()])}),t._v(" "),a("div",{staticClass:"swiper-button-prev",attrs:{slot:"button-prev"},slot:"button-prev"}),t._v(" "),a("div",{staticClass:"swiper-button-next",attrs:{slot:"button-next"},slot:"button-next"}),t._v(" "),a("div",{staticClass:"swiper-pagination",attrs:{slot:"pagination"},slot:"pagination"})],2),t._v(" "),a("div",{staticClass:"screen-controls mb-3 w-100 mx-auto"},[t.currentSlide?a("b-button",{attrs:{size:"sm",variant:"secondary"},on:{click:t.moveLeft}},[a("i",{staticClass:"fas fa-arrow-left"})]):t._e(),t._v(" "),a("b-button",{attrs:{size:"sm",variant:"info"},on:{click:t.addBefore}},[a("i",{staticClass:"fas fa-arrow-left"}),t._v(" "),a("i",{staticClass:"fas fa-plus"})]),t._v(" "),a("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:t.removeScreen}},[a("i",{staticClass:"fas fa-trash"})]),t._v(" "),a("b-button",{attrs:{size:"sm",variant:"info"},on:{click:t.addAfter}},[a("i",{staticClass:"fas fa-plus"}),t._v(" "),a("i",{staticClass:"fas fa-arrow-right"})]),t._v(" "),t.currentSlide!==t.screens.length-1?a("b-button",{attrs:{size:"sm",variant:"secondary"},on:{click:t.moveRight}},[a("i",{staticClass:"fas fa-arrow-right"})]):t._e()],1),t._v(" "),null!=t.currentSlide&&t.screens.length?a("div",{staticClass:"container mt-3"},[t.screens[t.currentScreenIndex]?a("div",[a("screen-editor",{key:t.screens[t.currentScreenIndex].name,attrs:{screenName:t.screens[t.currentScreenIndex].name,allScreenNames:t.activityData.meta.screens,screenData:t.screens[t.currentScreenIndex].meta},on:{changedValue:t.updateScreen,changedName:t.updateScreenName}})],1):t._e()]):t._e()],1)],1)],1):a("Unauthorized")],1)},staticRenderFns:[]};var Kt=a("VU/8")(Jt,Yt,!1,function(t){a("3CQJ")},"data-v-dc13c48a",null).exports,Zt={name:"EditActivitySetParentRoute",props:{user:{type:Object},isLoggedIn:{type:Boolean},authToken:{type:Object}},computed:{activitySetId:function(){return this.$route.params.activitySetId}}},Qt={render:function(){var t=this.$createElement;return(this._self._c||t)("router-view",{attrs:{activitySetId:this.activitySetId,authToken:this.authToken,user:this.user,isLoggedIn:this.isLoggedIn}})},staticRenderFns:[]},te=a("VU/8")(Zt,Qt,!1,null,null,null).exports;s.a.use(v.a);var ee=new v.a({mode:"history",routes:[{path:"/",name:"Home",component:f},{path:"/login",name:"Login",component:M},{path:"/signup",name:"SignUp",component:$},{path:"/signup",name:"SignUp",component:$},{path:"/forgot",name:"Forgot",component:It},{path:"/edit_activity_set/:activitySetId",name:"EditActivitySet",redirect:"/edit_activity_set/:activitySetId/",component:te,children:[{name:"edit_activity_set_overview",path:"/",component:Ft},{path:"edit_activity/:activityId",name:"EditActivity",component:Kt}]},{path:"/activitySets",name:"ActivitySets",component:F},{path:"/view_activity/:activityId",component:H,redirect:"/view_activity/:activityId/overview",children:[{name:"overview",path:"overview",component:J},{name:"view_user",path:"view_user/:userId",component:Dt}]}]});s.a.config.productionTip=!1,new s.a({el:"#app",router:ee,components:{App:h},template:"<App/>"})},UF1y:function(t,e){},Uy0G:function(t,e){},Vdvp:function(t,e){},VlMO:function(t,e){},XEh3:function(t,e){},dG3h:function(t,e){},e24b:function(t,e){},f47A:function(t,e,a){t.exports=a.p+"static/img/undraw_prototyping_process_rswj.67fa892.svg"},jKqc:function(t,e){},jwgv:function(t,e){},pWd1:function(t,e){},sXpr:function(t,e){},scZD:function(t,e){},uslO:function(t,e,a){var s={"./af":"3CJN","./af.js":"3CJN","./ar":"3MVc","./ar-dz":"tkWw","./ar-dz.js":"tkWw","./ar-kw":"j8cJ","./ar-kw.js":"j8cJ","./ar-ly":"wPpW","./ar-ly.js":"wPpW","./ar-ma":"dURR","./ar-ma.js":"dURR","./ar-sa":"7OnE","./ar-sa.js":"7OnE","./ar-tn":"BEem","./ar-tn.js":"BEem","./ar.js":"3MVc","./az":"eHwN","./az.js":"eHwN","./be":"3hfc","./be.js":"3hfc","./bg":"lOED","./bg.js":"lOED","./bm":"hng5","./bm.js":"hng5","./bn":"aM0x","./bn.js":"aM0x","./bo":"w2Hs","./bo.js":"w2Hs","./br":"OSsP","./br.js":"OSsP","./bs":"aqvp","./bs.js":"aqvp","./ca":"wIgY","./ca.js":"wIgY","./cs":"ssxj","./cs.js":"ssxj","./cv":"N3vo","./cv.js":"N3vo","./cy":"ZFGz","./cy.js":"ZFGz","./da":"YBA/","./da.js":"YBA/","./de":"DOkx","./de-at":"8v14","./de-at.js":"8v14","./de-ch":"Frex","./de-ch.js":"Frex","./de.js":"DOkx","./dv":"rIuo","./dv.js":"rIuo","./el":"CFqe","./el.js":"CFqe","./en-SG":"oYA3","./en-SG.js":"oYA3","./en-au":"Sjoy","./en-au.js":"Sjoy","./en-ca":"Tqun","./en-ca.js":"Tqun","./en-gb":"hPuz","./en-gb.js":"hPuz","./en-ie":"ALEw","./en-ie.js":"ALEw","./en-il":"QZk1","./en-il.js":"QZk1","./en-nz":"dyB6","./en-nz.js":"dyB6","./eo":"Nd3h","./eo.js":"Nd3h","./es":"LT9G","./es-do":"7MHZ","./es-do.js":"7MHZ","./es-us":"INcR","./es-us.js":"INcR","./es.js":"LT9G","./et":"XlWM","./et.js":"XlWM","./eu":"sqLM","./eu.js":"sqLM","./fa":"2pmY","./fa.js":"2pmY","./fi":"nS2h","./fi.js":"nS2h","./fo":"OVPi","./fo.js":"OVPi","./fr":"tzHd","./fr-ca":"bXQP","./fr-ca.js":"bXQP","./fr-ch":"VK9h","./fr-ch.js":"VK9h","./fr.js":"tzHd","./fy":"g7KF","./fy.js":"g7KF","./ga":"U5Iz","./ga.js":"U5Iz","./gd":"nLOz","./gd.js":"nLOz","./gl":"FuaP","./gl.js":"FuaP","./gom-latn":"+27R","./gom-latn.js":"+27R","./gu":"rtsW","./gu.js":"rtsW","./he":"Nzt2","./he.js":"Nzt2","./hi":"ETHv","./hi.js":"ETHv","./hr":"V4qH","./hr.js":"V4qH","./hu":"xne+","./hu.js":"xne+","./hy-am":"GrS7","./hy-am.js":"GrS7","./id":"yRTJ","./id.js":"yRTJ","./is":"upln","./is.js":"upln","./it":"FKXc","./it-ch":"/E8D","./it-ch.js":"/E8D","./it.js":"FKXc","./ja":"ORgI","./ja.js":"ORgI","./jv":"JwiF","./jv.js":"JwiF","./ka":"RnJI","./ka.js":"RnJI","./kk":"j+vx","./kk.js":"j+vx","./km":"5j66","./km.js":"5j66","./kn":"gEQe","./kn.js":"gEQe","./ko":"eBB/","./ko.js":"eBB/","./ku":"kI9l","./ku.js":"kI9l","./ky":"6cf8","./ky.js":"6cf8","./lb":"z3hR","./lb.js":"z3hR","./lo":"nE8X","./lo.js":"nE8X","./lt":"/6P1","./lt.js":"/6P1","./lv":"jxEH","./lv.js":"jxEH","./me":"svD2","./me.js":"svD2","./mi":"gEU3","./mi.js":"gEU3","./mk":"Ab7C","./mk.js":"Ab7C","./ml":"oo1B","./ml.js":"oo1B","./mn":"CqHt","./mn.js":"CqHt","./mr":"5vPg","./mr.js":"5vPg","./ms":"ooba","./ms-my":"G++c","./ms-my.js":"G++c","./ms.js":"ooba","./mt":"oCzW","./mt.js":"oCzW","./my":"F+2e","./my.js":"F+2e","./nb":"FlzV","./nb.js":"FlzV","./ne":"/mhn","./ne.js":"/mhn","./nl":"3K28","./nl-be":"Bp2f","./nl-be.js":"Bp2f","./nl.js":"3K28","./nn":"C7av","./nn.js":"C7av","./pa-in":"pfs9","./pa-in.js":"pfs9","./pl":"7LV+","./pl.js":"7LV+","./pt":"ZoSI","./pt-br":"AoDM","./pt-br.js":"AoDM","./pt.js":"ZoSI","./ro":"wT5f","./ro.js":"wT5f","./ru":"ulq9","./ru.js":"ulq9","./sd":"fW1y","./sd.js":"fW1y","./se":"5Omq","./se.js":"5Omq","./si":"Lgqo","./si.js":"Lgqo","./sk":"OUMt","./sk.js":"OUMt","./sl":"2s1U","./sl.js":"2s1U","./sq":"V0td","./sq.js":"V0td","./sr":"f4W3","./sr-cyrl":"c1x4","./sr-cyrl.js":"c1x4","./sr.js":"f4W3","./ss":"7Q8x","./ss.js":"7Q8x","./sv":"Fpqq","./sv.js":"Fpqq","./sw":"DSXN","./sw.js":"DSXN","./ta":"+7/x","./ta.js":"+7/x","./te":"Nlnz","./te.js":"Nlnz","./tet":"gUgh","./tet.js":"gUgh","./tg":"5SNd","./tg.js":"5SNd","./th":"XzD+","./th.js":"XzD+","./tl-ph":"3LKG","./tl-ph.js":"3LKG","./tlh":"m7yE","./tlh.js":"m7yE","./tr":"k+5o","./tr.js":"k+5o","./tzl":"iNtv","./tzl.js":"iNtv","./tzm":"FRPF","./tzm-latn":"krPU","./tzm-latn.js":"krPU","./tzm.js":"FRPF","./ug-cn":"To0v","./ug-cn.js":"To0v","./uk":"ntHu","./uk.js":"ntHu","./ur":"uSe8","./ur.js":"uSe8","./uz":"XU1s","./uz-latn":"/bsm","./uz-latn.js":"/bsm","./uz.js":"XU1s","./vi":"0X8Q","./vi.js":"0X8Q","./x-pseudo":"e/KL","./x-pseudo.js":"e/KL","./yo":"YXlc","./yo.js":"YXlc","./zh-cn":"Vz2w","./zh-cn.js":"Vz2w","./zh-hk":"ZUyn","./zh-hk.js":"ZUyn","./zh-tw":"BbgG","./zh-tw.js":"BbgG"};function i(t){return a(n(t))}function n(t){var e=s[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}i.keys=function(){return Object.keys(s)},i.resolve=n,t.exports=i,i.id="uslO"},v2ns:function(t,e){},zj2Q:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.632d6934b9b1b9469bf9.js.map